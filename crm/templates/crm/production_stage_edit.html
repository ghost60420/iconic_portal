{% extends "crm/base.html" %}
{% block content %}

<style>
  .stage-edit-page {
    max-width: 760px;
    margin: 24px auto;
  }

  .stage-edit-title {
    font-size: 20px;
    font-weight: 600;
    color: #ffffff;
  }

  .stage-edit-sub {
    font-size: 13px;
    color: #9ca3af;
  }

  .stage-edit-card {
    margin-top: 16px;
    background: radial-gradient(circle at top left, #1f2937, #050505);
    border-radius: 14px;
    border: 1px solid #1f2937;
    padding: 16px 18px;
  }

  .stage-header-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 10px;
    flex-wrap: wrap;
    margin-bottom: 10px;
  }

  .stage-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 11px;
    background: #111827;
    border: 1px solid #4b5563;
    color: #e5e7eb;
  }

  .stage-emoji {
    font-size: 14px;
  }

  .stage-form-grid {
    margin-top: 12px;
  }

  .stage-form-label {
    font-size: 12px;
    color: #d1d5db;
    margin-bottom: 2px;
  }

  .btn-gold {
    background: #f5d580;
    border-radius: 999px;
    border: none;
    color: #111827;
    padding: 6px 14px;
    font-size: 12px;
    font-weight: 600;
    text-decoration: none;
  }

  .btn-gold:hover {
    background: #ffe9a8;
    color: #020617;
  }

  .btn-ghost {
    background: transparent;
    border-radius: 999px;
    border: 1px solid #4b5563;
    color: #e5e7eb;
    padding: 6px 12px;
    font-size: 12px;
    text-decoration: none;
  }

  .btn-ghost:hover {
    background: #111827;
  }
</style>

<div class="stage-edit-page">

  <div class="d-flex justify-content-between align-items-center mb-1">
    <div>
      <div class="stage-edit-title">
        Edit stage
      </div>
      <div class="stage-edit-sub">
        {{ stage.order.title }}  
        Â· {{ stage.display_name|default:stage.get_stage_key_display }}
      </div>
    </div>
    <a href="{% url 'production_detail' stage.order_id %}" class="btn-ghost">
      Back to order
    </a>
  </div>

  <div class="stage-edit-card">

    <div class="stage-header-row">
      <div class="stage-badge">
        <span class="stage-emoji">
          {% if stage.stage_key == "development" %}
            ğŸ§ 
          {% elif stage.stage_key == "sampling" %}
            ğŸ§ª
          {% elif stage.stage_key == "cutting" %}
            âœ‚ï¸
          {% elif stage.stage_key == "sewing" %}
            ğŸ§µ
          {% elif stage.stage_key == "ironing" %}
            ğŸ§º
          {% elif stage.stage_key == "qc" %}
            âœ…
          {% elif stage.stage_key == "finishing" %}
            âœ¨
          {% elif stage.stage_key == "packing" %}
            ğŸ“¦
          {% elif stage.stage_key == "shipping" %}
            ğŸšš
          {% else %}
            âš™ï¸
          {% endif %}
        </span>
        <span>
          {{ stage.display_name|default:stage.get_stage_key_display }}
        </span>
      </div>

      <div class="small text-muted">
        Current status  
        <strong>{{ stage.get_status_display }}</strong>
      </div>
    </div>

    {% if form.errors %}
      <div class="alert alert-danger small mb-2">
        Please check the fields below.
      </div>
    {% endif %}

    <form method="post" class="stage-form-grid">
      {% csrf_token %}

      <div class="row g-3">

        <div class="col-md-4">
          <label class="stage-form-label">Status</label>
          {{ form.status }}
        </div>

        <div class="col-md-4">
          <label class="stage-form-label">Planned start</label>
          {{ form.planned_start }}
        </div>

        <div class="col-md-4">
          <label class="stage-form-label">Planned end</label>
          {{ form.planned_end }}
        </div>

        <div class="col-md-4">
          <label class="stage-form-label">Actual start</label>
          {{ form.actual_start }}
        </div>

        <div class="col-md-4">
          <label class="stage-form-label">Actual end</label>
          {{ form.actual_end }}
        </div>

        <div class="col-12">
          <label class="stage-form-label">Notes</label>
          {{ form.notes }}
        </div>

      </div>

      <div class="mt-3 d-flex gap-2">
        <button type="submit" class="btn-gold">
          Save stage
        </button>
        <a href="{% url 'production_detail' stage.order_id %}" class="btn-ghost">
          Cancel
        </a>
      </div>
    </form>

  </div>

</div>

{% endblock %}