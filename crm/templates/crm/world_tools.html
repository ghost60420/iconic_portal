{% extends "crm/base.html" %}

{% block content %}
<style>
  :root{
    --bg:#060606;
    --panel:#0b0d10;
    --panel2:#0f172a;
    --border:#2a2f38;
    --text:#f9fafb;
    --muted:#a8b0bd;
    --gold1:#ffe39b;
    --gold2:#e4c067;
  }

  .wt-wrap{
    max-width: 1200px;
    margin: 16px auto 28px auto;
    padding: 0 10px;
    color: var(--text);
  }

  .wt-header{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom: 14px;
  }

  .wt-title{
    font-size: 22px;
    font-weight: 900;
    color: #fff;
    margin: 0;
    letter-spacing: 0.2px;
  }

  .wt-sub{
    margin-top: 4px;
    font-size: 13px;
    color: var(--muted);
  }

  .wt-actions{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }

  .wt-btn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 14px;
    border-radius: 12px;
    font-weight: 800;
    font-size: 13px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.05);
    color: #f3f4f6;
    text-decoration:none;
    transition: transform 0.12s ease, background 0.12s ease, border-color 0.12s ease;
    white-space: nowrap;
  }

  .wt-btn:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,0.08);
    border-color: rgba(255,255,255,0.18);
    color: #fff;
  }

  .wt-btn-gold{
    background: linear-gradient(180deg, rgba(255,227,155,0.18), rgba(228,192,103,0.10));
    border-color: rgba(255,227,155,0.25);
  }

  .wt-grid{
    display:grid;
    grid-template-columns: repeat(12, 1fr);
    gap: 12px;
  }

  .wt-card{
    background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
    border: 1px solid rgba(255,255,255,0.10);
    border-radius: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.45);
    overflow:hidden;
  }

  .wt-card-inner{
    padding: 14px;
  }

  .wt-card-title{
    font-size: 14px;
    font-weight: 900;
    margin: 0 0 10px 0;
    color: #fff;
    letter-spacing: 0.2px;
    display:flex;
    align-items:center;
    gap:8px;
  }

  .wt-note{
    font-size: 12px;
    color: var(--muted);
  }

  .wt-divider{
    height: 1px;
    background: rgba(255,255,255,0.10);
    margin: 12px 0;
  }

  .wt-input, .wt-select{
    width:100%;
    padding: 10px 10px;
    border-radius: 12px;
    background: rgba(0,0,0,0.35);
    border: 1px solid rgba(255,255,255,0.12);
    color: var(--text);
    font-size: 13px;
    outline: none;
  }

  .wt-input:focus, .wt-select:focus{
    border-color: rgba(255,227,155,0.35);
    box-shadow: 0 0 0 3px rgba(255,227,155,0.10);
  }

  .wt-row{
    display:grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 8px;
  }

  .wt-row-2{
    display:grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
  }

  .wt-row-4{
    display:grid;
    grid-template-columns: 1fr 1fr 1fr 1fr;
    gap: 8px;
  }

  .wt-submit{
    width: 100%;
    padding: 10px 12px;
    border-radius: 12px;
    font-weight: 900;
    font-size: 13px;
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.06);
    color: #fff;
    cursor:pointer;
    transition: transform 0.12s ease, background 0.12s ease;
  }

  .wt-submit:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,0.09);
  }

  .wt-pill{
    display:inline-flex;
    align-items:center;
    gap:6px;
    padding: 6px 10px;
    border-radius: 999px;
    border: 1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.04);
    font-size: 12px;
    font-weight: 800;
    color: var(--gold1);
  }

  .wt-list{
    display:flex;
    flex-direction:column;
    gap: 10px;
  }

  .wt-item{
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap: 10px;
    padding: 10px 12px;
    border-radius: 14px;
    border: 1px solid rgba(255,255,255,0.10);
    background: rgba(0,0,0,0.28);
  }

  .wt-item-left{
    display:flex;
    flex-direction:column;
    gap: 2px;
    min-width: 0;
  }

  .wt-item-title{
    font-weight: 900;
    font-size: 13px;
    color: #fff;
    line-height: 1.1;
  }

  .wt-item-sub{
    font-size: 12px;
    color: var(--muted);
    line-height: 1.2;
  }

  .wt-item-right{
    display:flex;
    align-items:center;
    gap: 10px;
    flex-wrap:wrap;
    justify-content:flex-end;
  }

  .wt-time{
    font-family: "Courier New", monospace;
    font-size: 16px;
    font-weight: 900;
    letter-spacing: 0.5px;
  }

  .wt-remove{
    border: 1px solid rgba(255,255,255,0.14);
    background: rgba(255,255,255,0.05);
    color: #fff;
    border-radius: 999px;
    padding: 7px 10px;
    font-size: 12px;
    font-weight: 900;
    cursor:pointer;
    transition: background 0.12s ease, transform 0.12s ease;
  }

  .wt-remove:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,0.09);
  }

  .wt-warn{
    color: #f5d580;
    font-size: 12px;
    margin-top: 8px;
  }

  /* grid spans */
  .span-4{ grid-column: span 4; }
  .span-6{ grid-column: span 6; }
  .span-12{ grid-column: span 12; }

  /* dropdown */
  .wt-dd{
    position: relative;
    display: inline-block;
  }

  .wt-dd-btn{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:10px 14px;
    border-radius:12px;
    font-size:13px;
    font-weight:900;
    border:1px solid rgba(255,255,255,0.12);
    background: rgba(255,255,255,0.05);
    color:#f3f4f6;
    cursor:pointer;
    user-select:none;
    line-height:1;
    transition: transform 0.12s ease, background 0.12s ease, border-color 0.12s ease;
    white-space: nowrap;
  }

  .wt-dd-btn:hover{
    transform: translateY(-1px);
    background: rgba(255,255,255,0.08);
    border-color: rgba(255,255,255,0.18);
    color:#fff;
  }

  .wt-dd-menu{
    display:none;
    position:absolute;
    right:0;
    top: calc(100% + 8px);
    min-width: 260px;
    background: #0b0d10;
    border: 1px solid rgba(255,255,255,0.12);
    border-radius: 14px;
    box-shadow: 0 14px 40px rgba(0,0,0,0.55);
    overflow:hidden;
    z-index: 9999;
  }

  .wt-dd.open .wt-dd-menu{
    display:block;
  }

  .wt-dd-link{
    display:flex;
    gap:10px;
    align-items:flex-start;
    padding: 12px 12px;
    text-decoration:none;
    color:#f3f4f6;
    border-bottom: 1px solid rgba(255,255,255,0.08);
  }

  .wt-dd-link:last-child{
    border-bottom: none;
  }

  .wt-dd-link:hover{
    background: rgba(255,255,255,0.06);
    color:#fff;
  }

  .wt-dd-ico{
    font-size: 16px;
    line-height: 1;
    margin-top: 1px;
  }

  .wt-dd-title{
    font-weight: 900;
    font-size: 13px;
    margin: 0;
  }

  .wt-dd-sub{
    margin: 2px 0 0 0;
    font-size: 12px;
    color: #a8b0bd;
  }

  @media (max-width: 992px){
    .span-4{ grid-column: span 12; }
    .span-6{ grid-column: span 12; }
    .wt-row{ grid-template-columns: 1fr; }
    .wt-row-2{ grid-template-columns: 1fr; }
    .wt-row-4{ grid-template-columns: 1fr; }
    .wt-item-right{ justify-content:flex-start; }
    .wt-dd-menu{ left:0; right:auto; }
  }
</style>

<div class="wt-wrap">

  <div class="wt-header">
    <div>
      <h1 class="wt-title">World tools</h1>
      <div class="wt-sub">Time, money, weather and simple signals for daily work.</div>
    </div>

    <div class="wt-actions">

      <div class="wt-dd" id="wt-dd">
        <button type="button" class="wt-dd-btn" id="wt-dd-btn">
          üåç World pages <span style="opacity:0.9;">‚ñæ</span>
        </button>

        <div class="wt-dd-menu" id="wt-dd-menu">
          <a class="wt-dd-link" href="{% url 'world_dashboard' %}">
            <div class="wt-dd-ico">üìä</div>
            <div>
              <div class="wt-dd-title">World dashboard</div>
              <div class="wt-dd-sub">Time, currency, and AI update</div>
            </div>
          </a>

          <a class="wt-dd-link" href="{% url 'world_ai_fashion_news' %}">
            <div class="wt-dd-ico">üß†</div>
            <div>
              <div class="wt-dd-title">AI fashion notes</div>
              <div class="wt-dd-sub">Quick notes before buyer calls</div>
            </div>
          </a>
        </div>
      </div>

      <a class="wt-btn" href="{% url 'leads_list' %}">CRM Home</a>
    </div>
  </div>

  <div class="wt-grid">

    <!-- CLOCK -->
    <div class="wt-card span-4">
      <div class="wt-card-inner">
        <div class="wt-card-title">üïí World clock</div>

        <div id="clockList" class="wt-list"></div>

        <div class="wt-divider"></div>

        <form id="clockForm">
          <div class="wt-note" style="margin-bottom:8px;">Add city and UTC offset</div>

          <div class="wt-row">
            <input id="clockCity" class="wt-input" placeholder="City name">
            <input id="clockOffset" class="wt-input" type="number" step="0.5" placeholder="UTC offset">
            <button type="submit" class="wt-submit">Add</button>
          </div>

          <div class="wt-note" style="margin-top:8px;">
            Example: Dhaka 6, London 0, Vancouver minus 8
          </div>
        </form>
      </div>
    </div>

    <!-- CURRENCY -->
    <div class="wt-card span-4">
      <div class="wt-card-inner">
        <div class="wt-card-title">üí± Currency converter</div>

        <div class="wt-row-2" style="margin-bottom:8px;">
          <div>
            <div class="wt-note" style="margin-bottom:6px;">Amount</div>
            <input id="amountInput" class="wt-input" type="number" value="1">
          </div>
          <div style="display:flex;align-items:flex-end;">
            <button type="button" class="wt-submit" onclick="convertCurrency()">Convert</button>
          </div>
        </div>

        <div class="wt-row-2">
          <div>
            <div class="wt-note" style="margin-bottom:6px;">From</div>
            <select id="fromSelect" class="wt-select">
              <option value="USD">USD</option>
              <option value="CAD">CAD</option>
              <option value="EUR">EUR</option>
              <option value="BDT">BDT</option>
            </select>
          </div>
          <div>
            <div class="wt-note" style="margin-bottom:6px;">To</div>
            <select id="toSelect" class="wt-select">
              <option value="CAD">CAD</option>
              <option value="USD">USD</option>
              <option value="EUR">EUR</option>
              <option value="BDT">BDT</option>
            </select>
          </div>
        </div>

        <div style="margin-top:12px;">
          <div id="currencyResult" style="font-size:13px;font-weight:800;"></div>
          <div id="currencyError" class="wt-warn"></div>
        </div>

        <div class="wt-divider"></div>

        <div class="wt-note">
          Sample rates only. Final money should be confirmed by bank or your costing sheet.
        </div>
      </div>
    </div>

    <!-- WEATHER -->
    <div class="wt-card span-4">
      <div class="wt-card-inner">
        <div class="wt-card-title">üå¶ Buyer weather</div>

        <div id="weatherList" class="wt-list"></div>

        <div class="wt-divider"></div>

        <form id="weatherForm">
          <div class="wt-note" style="margin-bottom:8px;">Add city weather note</div>

          <div class="wt-row-4" style="margin-bottom:8px;">
            <input id="weatherCity" class="wt-input" placeholder="City">
            <input id="weatherTemp" class="wt-input" type="number" placeholder="Temp C">
            <select id="weatherCondition" class="wt-select">
              <option value="sunny">Sunny</option>
              <option value="cloudy">Cloudy</option>
              <option value="rainy">Rainy</option>
              <option value="snow">Snow</option>
              <option value="hot">Hot</option>
            </select>
            <button type="submit" class="wt-submit">Add</button>
          </div>

          <input id="weatherNote" class="wt-input" placeholder="Short note example hoodies time">
          <div class="wt-note" style="margin-top:8px;">
            Cold cities push fleece. Warm cities push light items and resort.
          </div>
        </form>
      </div>
    </div>

    <!-- SHIPPING -->
    <div class="wt-card span-4">
      <div class="wt-card-inner">
        <div class="wt-card-title">üöö Shipping time map</div>

        <div style="overflow:auto;">
          <table style="width:100%; font-size:12px; border-collapse: collapse;">
            <thead>
              <tr style="color:var(--muted);">
                <th style="text-align:left; padding:8px 6px;">Route</th>
                <th style="text-align:left; padding:8px 6px;">Sea days</th>
                <th style="text-align:left; padding:8px 6px;">Air days</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td style="padding:8px 6px;">Dhaka to Vancouver</td>
                <td style="padding:8px 6px;">30 to 35</td>
                <td style="padding:8px 6px;">5 to 7</td>
              </tr>
              <tr>
                <td style="padding:8px 6px;">Dhaka to Toronto</td>
                <td style="padding:8px 6px;">28 to 32</td>
                <td style="padding:8px 6px;">4 to 6</td>
              </tr>
              <tr>
                <td style="padding:8px 6px;">Dhaka to New York</td>
                <td style="padding:8px 6px;">25 to 30</td>
                <td style="padding:8px 6px;">4 to 6</td>
              </tr>
              <tr>
                <td style="padding:8px 6px;">Dhaka to London</td>
                <td style="padding:8px 6px;">22 to 28</td>
                <td style="padding:8px 6px;">3 to 5</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="wt-note" style="margin-top:10px;">
          Tip: for rush orders compare air cost with near country options.
        </div>
      </div>
    </div>

    <!-- TREND -->
    <div class="wt-card span-4">
      <div class="wt-card-inner">
        <div class="wt-card-title">üìà USD to CAD trend</div>
        <canvas id="currencyTrendChart" height="150"></canvas>
        <div class="wt-note" style="margin-top:10px;">
          Sample chart for direction only.
        </div>
      </div>
    </div>

    <!-- FABRIC -->
    <div class="wt-card span-4">
      <div class="wt-card-inner">
        <div class="wt-card-title">üßµ Fabric price index</div>

        <div style="overflow:auto;">
          <table style="width:100%; font-size:12px; border-collapse: collapse;">
            <thead>
              <tr style="color:var(--muted);">
                <th style="text-align:left; padding:8px 6px;">Fabric</th>
                <th style="text-align:left; padding:8px 6px;">GSM</th>
                <th style="text-align:left; padding:8px 6px;">USD per kg</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td style="padding:8px 6px;">Cotton single jersey</td>
                <td style="padding:8px 6px;">180 to 200</td>
                <td style="padding:8px 6px;">4.2</td>
              </tr>
              <tr>
                <td style="padding:8px 6px;">Cotton fleece</td>
                <td style="padding:8px 6px;">300 to 320</td>
                <td style="padding:8px 6px;">5.3</td>
              </tr>
              <tr>
                <td style="padding:8px 6px;">Cotton terry</td>
                <td style="padding:8px 6px;">260 to 280</td>
                <td style="padding:8px 6px;">4.8</td>
              </tr>
              <tr>
                <td style="padding:8px 6px;">Poly spandex jersey</td>
                <td style="padding:8px 6px;">220 to 240</td>
                <td style="padding:8px 6px;">5.9</td>
              </tr>
            </tbody>
          </table>
        </div>

        <div class="wt-note" style="margin-top:10px;">
          Later you can update these from real mill quotes.
        </div>
      </div>
    </div>

  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
  // dropdown open close
  (function () {
    const wrap = document.getElementById("wt-dd");
    const btn = document.getElementById("wt-dd-btn");
    const menu = document.getElementById("wt-dd-menu");
    if (!wrap || !btn || !menu) return;

    function closeMenu() {
      wrap.classList.remove("open");
    }

    btn.addEventListener("click", function (e) {
      e.preventDefault();
      e.stopPropagation();
      wrap.classList.toggle("open");
    });

    document.addEventListener("click", function () {
      closeMenu();
    });

    menu.addEventListener("click", function (e) {
      e.stopPropagation();
    });
  })();

  function loadJson(key, defaultValue) {
    try {
      const raw = localStorage.getItem(key);
      if (!raw) return defaultValue;
      return JSON.parse(raw);
    } catch (e) {
      return defaultValue;
    }
  }

  function saveJson(key, value) {
    try {
      localStorage.setItem(key, JSON.stringify(value));
    } catch (e) {}
  }

  // CLOCK
  function getClockCities() {
    const defaultCities = [
      { name: "Vancouver", offset: -8 },
      { name: "New York", offset: -5 },
      { name: "London", offset: 0 },
      { name: "Dhaka", offset: 6 }
    ];
    return loadJson("worldToolsClockCities", defaultCities);
  }

  function setClockCities(list) {
    saveJson("worldToolsClockCities", list);
  }

  function formatTimeOfDay(date) {
    let hours = date.getHours();
    const minutes = String(date.getMinutes()).padStart(2, "0");
    const seconds = String(date.getSeconds()).padStart(2, "0");
    const ampm = hours >= 12 ? "PM" : "AM";
    hours = hours % 12;
    if (hours === 0) hours = 12;
    return String(hours).padStart(2, "0") + ":" + minutes + ":" + seconds + " " + ampm;
  }

  function updateClock() {
    const cities = getClockCities();
    const container = document.getElementById("clockList");
    if (!container) return;

    const now = new Date();
    const utcMs = now.getTime() + now.getTimezoneOffset() * 60000;

    let html = "";
    cities.forEach(function (city, index) {
      const cityDate = new Date(utcMs + city.offset * 3600000);
      const timeString = formatTimeOfDay(cityDate);

      html += `
        <div class="wt-item">
          <div class="wt-item-left">
            <div class="wt-item-title">${city.name}</div>
            <div class="wt-item-sub">UTC ${city.offset >= 0 ? "+" : ""}${city.offset}</div>
          </div>
          <div class="wt-item-right">
            <div class="wt-time">${timeString}</div>
            <button type="button" class="wt-remove" data-index="${index}">Remove</button>
          </div>
        </div>
      `;
    });

    container.innerHTML = html;

    container.querySelectorAll(".wt-remove").forEach(function (btn) {
      btn.addEventListener("click", function () {
        const idx = parseInt(this.getAttribute("data-index"));
        const list = getClockCities();
        list.splice(idx, 1);
        setClockCities(list);
        updateClock();
      });
    });
  }

  function initClockForm() {
    const form = document.getElementById("clockForm");
    if (!form) return;

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const nameInput = document.getElementById("clockCity");
      const offsetInput = document.getElementById("clockOffset");
      const name = (nameInput.value || "").trim();
      const offset = parseFloat(offsetInput.value);

      if (!name || isNaN(offset)) {
        alert("Please enter a city and UTC offset.");
        return;
      }

      const list = getClockCities();
      list.push({ name: name, offset: offset });
      setClockCities(list);

      nameInput.value = "";
      offsetInput.value = "";
      updateClock();
    });
  }

  // WEATHER
  function getWeatherCities() {
    const defaultWeather = [
      { city: "Vancouver", temp: 8, note: "Cool and cloudy", condition: "cloudy" },
      { city: "Toronto", temp: 2, note: "Cold, chance of snow", condition: "snow" },
      { city: "New York", temp: 10, note: "Mild and clear", condition: "sunny" },
      { city: "London", temp: 7, note: "Cloudy and light rain", condition: "rainy" },
      { city: "Dhaka", temp: 24, note: "Warm and humid", condition: "hot" }
    ];
    return loadJson("worldToolsWeatherCities", defaultWeather);
  }

  function setWeatherCities(list) {
    saveJson("worldToolsWeatherCities", list);
  }

  function getConditionIcon(cond) {
    const c = (cond || "").toLowerCase();
    if (c === "sunny") return "‚òÄ";
    if (c === "cloudy") return "‚òÅ";
    if (c === "rainy") return "üåß";
    if (c === "snow") return "‚ùÑ";
    if (c === "hot") return "üî•";
    return "‚õÖ";
  }

  function renderWeather() {
    const list = getWeatherCities();
    const box = document.getElementById("weatherList");
    if (!box) return;

    let html = "";
    list.forEach(function (item, index) {
      html += `
        <div class="wt-item">
          <div class="wt-item-left">
            <div class="wt-item-title">${item.city} <span class="wt-pill">${getConditionIcon(item.condition)} ${item.temp} C</span></div>
            <div class="wt-item-sub">${item.note || ""}</div>
          </div>
          <div class="wt-item-right">
            <button type="button" class="wt-remove" data-index="${index}">Remove</button>
          </div>
        </div>
      `;
    });

    box.innerHTML = html;

    box.querySelectorAll(".wt-remove").forEach(function (btn) {
      btn.addEventListener("click", function () {
        const idx = parseInt(this.getAttribute("data-index"));
        const items = getWeatherCities();
        items.splice(idx, 1);
        setWeatherCities(items);
        renderWeather();
      });
    });
  }

  function initWeatherForm() {
    const form = document.getElementById("weatherForm");
    if (!form) return;

    form.addEventListener("submit", function (e) {
      e.preventDefault();
      const cityInput = document.getElementById("weatherCity");
      const tempInput = document.getElementById("weatherTemp");
      const noteInput = document.getElementById("weatherNote");
      const condSelect = document.getElementById("weatherCondition");

      const city = (cityInput.value || "").trim();
      const temp = parseFloat(tempInput.value);
      const note = (noteInput.value || "").trim();
      const cond = condSelect.value || "cloudy";

      if (!city || isNaN(temp)) {
        alert("Please enter a city and temperature.");
        return;
      }

      const items = getWeatherCities();
      items.push({
        city: city,
        temp: temp,
        note: note || "Custom note",
        condition: cond
      });
      setWeatherCities(items);

      cityInput.value = "";
      tempInput.value = "";
      noteInput.value = "";
      condSelect.value = "sunny";
      renderWeather();
    });
  }

  // CURRENCY (offline sample rates)
  const offlineRates = {
    "USD_CAD": 1.37,
    "CAD_USD": 0.73,
    "USD_BDT": 120,
    "BDT_USD": 0.0083,
    "CAD_BDT": 88,
    "BDT_CAD": 0.0114,
    "EUR_USD": 1.09,
    "USD_EUR": 0.92,
    "EUR_CAD": 1.49,
    "CAD_EUR": 0.67
  };

  function getOfflineRate(from, to) {
    if (from === to) return 1;
    const key = from + "_" + to;
    return offlineRates[key] || null;
  }

  function convertCurrency() {
    const amountInput = document.getElementById("amountInput");
    const fromSelect = document.getElementById("fromSelect");
    const toSelect = document.getElementById("toSelect");
    const resultEl = document.getElementById("currencyResult");
    const errorEl = document.getElementById("currencyError");

    const amount = parseFloat(amountInput.value || "0");
    const from = fromSelect.value;
    const to = toSelect.value;

    resultEl.textContent = "";
    errorEl.textContent = "";

    if (!amount || amount <= 0) {
      errorEl.textContent = "Please enter a number bigger than zero.";
      return;
    }

    const rate = getOfflineRate(from, to);
    if (!rate) {
      errorEl.textContent = "No sample rate set for this pair. Update it later in code.";
      return;
    }

    const converted = (amount * rate).toFixed(2);
    resultEl.innerHTML = amount.toFixed(2) + " " + from + " is about <strong>" + converted + " " + to + "</strong>";
    errorEl.textContent = "Sample rates only. Final money should be confirmed.";
  }

  // TREND CHART
  let _trendChart = null;
  function renderCurrencyTrend() {
    const canvas = document.getElementById("currencyTrendChart");
    if (!canvas || !window.Chart) return;

    if (_trendChart) {
      _trendChart.destroy();
      _trendChart = null;
    }

    const labels = ["Day 1","Day 2","Day 3","Day 4","Day 5","Day 6","Day 7"];
    const data = [1.34, 1.35, 1.36, 1.37, 1.38, 1.37, 1.36];

    _trendChart = new Chart(canvas, {
      type: "line",
      data: {
        labels: labels,
        datasets: [{
          label: "USD to CAD",
          data: data,
          tension: 0.3,
          borderWidth: 2,
          pointRadius: 2
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { ticks: { font: { size: 10 } } },
          y: { ticks: { font: { size: 10 } } }
        }
      }
    });
  }

  document.addEventListener("DOMContentLoaded", function () {
    initClockForm();
    updateClock();
    setInterval(updateClock, 1000);

    initWeatherForm();
    renderWeather();

    convertCurrency();
    renderCurrencyTrend();
  });
</script>
{% endblock %}
