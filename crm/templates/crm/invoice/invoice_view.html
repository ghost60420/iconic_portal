{% extends "crm/base.html" %}
{% load humanize %}
{% block content %}

<style>
  :root{
    --bg:#020617;
    --bg2:#030712;
    --line:#334155;
    --text:#f9fafb;
    --muted:#9ca3af;
    --good:#4ade80;
    --warn:#fbbf24;
    --bad:#fb7185;
  }

  .wrap{
    max-width:1100px;
    margin:0 auto;
    color:var(--text);
  }

  .head{
    display:flex;
    justify-content:space-between;
    align-items:flex-start;
    gap:12px;
    flex-wrap:wrap;
    margin-bottom:14px;
  }

  .title{
    margin:0;
    font-weight:900;
    letter-spacing:0.2px;
  }

  .sub{
    margin-top:4px;
    font-size:12px;
    font-weight:800;
    color:var(--muted);
    line-height:1.4;
  }

  .btnbar{
    display:flex;
    gap:10px;
    flex-wrap:wrap;
    align-items:center;
  }

  .pill{
    display:inline-flex;
    align-items:center;
    justify-content:center;
    padding:8px 14px;
    border-radius:999px;
    font-weight:900;
    font-size:12px;
    border:1px solid rgba(255,255,255,0.14);
    background:linear-gradient(145deg,#0f172a,var(--bg));
    color:var(--text);
    text-decoration:none;
    box-shadow:0 3px 0 #020617;
    white-space:nowrap;
  }
  .pill:hover{ filter:brightness(1.05); text-decoration:none; }

  .pill.gold{
    background:linear-gradient(145deg,#f5d580,#d4b35f);
    color:#111827;
    border-color:rgba(255,215,128,0.55);
  }

  .cardx{
    background:linear-gradient(180deg, rgba(255,255,255,0.05), rgba(255,255,255,0.02));
    border:1px solid var(--line);
    border-radius:18px;
    box-shadow:0 16px 36px rgba(0,0,0,0.55);
    overflow:hidden;
  }

  .pad{ padding:14px; }

  .grid{
    display:grid;
    grid-template-columns: 1.2fr 0.8fr;
    gap:12px;
    align-items:start;
  }

  @media (max-width: 900px){
    .grid{ grid-template-columns:1fr; }
  }

  .kv{
    display:grid;
    grid-template-columns: 160px 1fr;
    gap:10px 14px;
    font-size:13px;
  }
  @media (max-width: 600px){
    .kv{ grid-template-columns:1fr; }
  }

  .k{
    color:var(--muted);
    font-weight:900;
    font-size:12px;
    text-transform:uppercase;
    letter-spacing:0.4px;
  }

  .v{
    color:var(--text);
    font-weight:800;
    word-break:break-word;
  }

  .v a{
    color:#fbbf24;
    text-decoration:none;
    font-weight:900;
  }
  .v a:hover{ text-decoration:underline; }

  .status{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:6px 10px;
    border-radius:999px;
    font-weight:900;
    font-size:12px;
    border:1px solid rgba(255,255,255,0.14);
    background:rgba(255,255,255,0.03);
  }
  .s-draft{ color:#e5e7eb; }
  .s-sent{ color:var(--warn); }
  .s-partial{ color:var(--warn); }
  .s-paid{ color:var(--good); }
  .s-cancelled{ color:var(--bad); }
  .s-unknown{ color:#e5e7eb; }

  .totals{
    width:100%;
    border-collapse:collapse;
    font-size:13px;
  }
  .totals td{
    padding:8px 0;
    border-bottom:1px solid rgba(148,163,184,0.18);
    font-weight:800;
  }
  .totals td:first-child{ color:var(--muted); }
  .totals td:last-child{ text-align:right; }

  .bigTotal{
    font-size:18px;
    font-weight:900;
  }

  .note{
    margin-top:10px;
    font-size:12px;
    color:var(--muted);
    font-weight:800;
    line-height:1.45;
    white-space:pre-wrap;
  }

  .mono{
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
  }

  .printHeader{
    display:none;
    margin-bottom:12px;
  }
  .printHeader .line{
    margin-top:6px;
    font-size:12px;
    font-weight:800;
    color:#111827;
  }

  @media print{
    .btnbar, .pill, .noPrint{ display:none !important; }
    .cardx{ box-shadow:none; }
    body{ background:#fff !important; }
    .wrap{ color:#111827 !important; }
    .cardx{ border:1px solid #d1d5db !important; background:#fff !important; }
    .k{ color:#374151 !important; }
    .v{ color:#111827 !important; }
    .sub{ color:#374151 !important; }
    .status{ border-color:#d1d5db !important; background:#fff !important; }
    .printHeader{ display:block; }
    .v a{ color:#111827 !important; text-decoration:none !important; }
  }
</style>

{% with cur=invoice.currency|default:"" invno=invoice.invoice_number|default:"" %}
<div class="container-fluid">
  <div class="wrap">

    <div class="printHeader">
      <div style="font-size:18px; font-weight:900;">Invoice</div>
      <div class="line">Invoice number: <span class="mono">{{ invno }}</span></div>
      <div class="line">Issue date: {{ invoice.issue_date|date:"Y-m-d"|default:"" }}</div>
      {% if invoice.customer %}
        <div class="line">Customer: {{ invoice.customer }}</div>
      {% endif %}
      {% if cur %}
        <div class="line">Currency: {{ cur }}</div>
      {% endif %}
    </div>

    <div class="head">
      <div>
        <h2 class="title">Invoice {{ invno }}</h2>
        <div class="sub">
          Issue {{ invoice.issue_date|date:"Y-m-d"|default:"" }}
          {% if invoice.due_date %} | Due {{ invoice.due_date|date:"Y-m-d" }}{% endif %}
          {% if cur %} | Currency {{ cur }}{% endif %}
        </div>
      </div>

      <div class="btnbar noPrint">
        <a class="pill" href="{% url 'invoice_list' %}">Back to invoices</a>
        {% if invoice.pk %}
          <a class="pill gold" href="{% url 'invoice_edit' invoice.pk %}">Edit</a>
        {% endif %}
        <a class="pill" href="#" onclick="window.print();return false;">Print</a>
      </div>
    </div>

    <div class="grid">

      <div class="cardx">
        <div class="pad">

          <div style="display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; align-items:center; margin-bottom:10px;">
            <div style="font-weight:900;">Invoice details</div>

            {% if invoice.status == "draft" %}
              <span class="status s-draft">Draft</span>
            {% elif invoice.status == "sent" %}
              <span class="status s-sent">Sent</span>
            {% elif invoice.status == "partial" %}
              <span class="status s-partial">Partly paid</span>
            {% elif invoice.status == "paid" %}
              <span class="status s-paid">Paid</span>
            {% elif invoice.status == "cancelled" %}
              <span class="status s-cancelled">Cancelled</span>
            {% else %}
              <span class="status s-unknown">Unknown</span>
            {% endif %}
          </div>

          <div class="kv">
            <div class="k">Customer</div>
            <div class="v">
              {% if invoice.customer %}{{ invoice.customer }}{% else %}Not set{% endif %}
            </div>

            <div class="k">Order</div>
            <div class="v">
              {% if invoice.order %}{{ invoice.order }}{% else %}Not linked{% endif %}
            </div>

            <div class="k">Issue date</div>
            <div class="v">{{ invoice.issue_date|date:"Y-m-d"|default:"" }}</div>

            <div class="k">Due date</div>
            <div class="v">
              {% if invoice.due_date %}{{ invoice.due_date|date:"Y-m-d" }}{% else %}Not set{% endif %}
            </div>

            <div class="k">Paid amount</div>
            <div class="v">
              {% if cur %}{{ cur }} {% endif %}
              {{ invoice.paid_amount|default_if_none:0|floatformat:2|intcomma }}
            </div>

            <div class="k">Balance</div>
            <div class="v">
              {% if cur %}{{ cur }} {% endif %}
              {{ invoice.balance|default_if_none:0|floatformat:2|intcomma }}
            </div>
          </div>

          {% if invoice.notes %}
            <div class="note">
              <div style="margin-bottom:6px; color:var(--text); font-weight:900;">Notes</div>
              {{ invoice.notes }}
            </div>
          {% endif %}

        </div>
      </div>

      <div class="cardx">
        <div class="pad">

          <div style="font-weight:900; margin-bottom:10px;">Totals</div>

          <table class="totals">
            <tr>
              <td>Subtotal</td>
              <td>{% if cur %}{{ cur }} {% endif %}{{ invoice.subtotal|default_if_none:0|floatformat:2|intcomma }}</td>
            </tr>
            <tr>
              <td>Shipping</td>
              <td>{% if cur %}{{ cur }} {% endif %}{{ invoice.shipping_amount|default_if_none:0|floatformat:2|intcomma }}</td>
            </tr>
            <tr>
              <td>Discount</td>
              <td>{% if cur %}{{ cur }} {% endif %}{{ invoice.discount_amount|default_if_none:0|floatformat:2|intcomma }}</td>
            </tr>
            <tr>
              <td>Tax</td>
              <td>{% if cur %}{{ cur }} {% endif %}{{ invoice.tax_amount|default_if_none:0|floatformat:2|intcomma }}</td>
            </tr>
            <tr>
              <td class="bigTotal">Total</td>
              <td class="bigTotal">
                {% if cur %}{{ cur }} {% endif %}
                {{ invoice.total_amount|default_if_none:0|floatformat:2|intcomma }}
              </td>
            </tr>
          </table>

          <div class="sub" style="margin-top:10px;">
            Rule: subtotal + shipping + tax minus discount.
          </div>

        </div>
      </div>

    </div>

  </div>
</div>
{% endwith %}

{% endblock %}