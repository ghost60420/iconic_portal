{% extends "crm/base.html" %}
{% load humanize %}
{% block content %}

<div class="container-fluid" style="color:#f9fafb;">

  <style>
    :root{
      --bg:#020617;
      --bg2:#030712;
      --line:#374151;
      --line2:#111827;
      --text:#f9fafb;
      --muted:#cbd5e1;
      --good:#86efac;
      --bad:#ffb4b4;
      --gold1:#ffe39b;
      --gold2:#e4c067;
    }

    .wrap{ max-width:1400px; margin:0 auto; }

    .cardx{
      background:var(--bg);
      border:1px solid var(--line);
      border-radius:16px;
      box-shadow:0 14px 34px rgba(0,0,0,0.38);
      overflow:hidden;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:flex-start;
      gap:14px;
      flex-wrap:wrap;
      margin-bottom:14px;
    }
    .title{ margin:0; font-weight:900; letter-spacing:0.2px; }
    .subtitle{ font-size:12px; color:var(--muted); font-weight:700; margin-top:4px; }

    .pillbar{ display:flex; flex-wrap:wrap; gap:10px; align-items:center; }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding:8px 14px;
      border-radius:999px;
      font-size:12px;
      font-weight:900;
      border:1px solid rgba(255,255,255,0.14);
      text-decoration:none;
      white-space:nowrap;
      background:linear-gradient(145deg,#111827,var(--bg));
      color:var(--text);
      box-shadow:0 3px 0 #020617;
      cursor:pointer;
    }
    .pill:hover{ filter:brightness(1.05); text-decoration:none; }
    .pill-gold{
      background:linear-gradient(145deg,var(--gold1),var(--gold2));
      color:#121212;
      border-color:#f6d488;
      box-shadow:0 3px 0 #8a6b24;
    }

    .inp{
      background:var(--bg2) !important;
      border-color:#4b5563 !important;
      color:var(--text) !important;
      font-weight:800;
    }
    .inp::placeholder{ color:#94a3b8; font-weight:800; }
    .label{ color:var(--text); font-weight:900; font-size:12px; }

    .kpi-label{
      font-size:11px;
      text-transform:uppercase;
      color:#e5e7eb;
      letter-spacing:0.45px;
      font-weight:900;
    }
    .kpi-val{
      font-size:22px;
      font-weight:900;
      line-height:1.15;
      word-break:break-word;
    }
    .kpi-sub{
      font-size:12px;
      color:var(--muted);
      font-weight:700;
      margin-top:6px;
    }

    .pos{ color:var(--good); font-weight:900; }
    .neg{ color:var(--bad); font-weight:900; }
  </style>

  <div class="wrap">

    <div class="topbar">
      <div>
        <h2 class="title">Transfer money</h2>
        <div class="subtitle">Canada totals in CAD and BDT.</div>
      </div>

      <div class="pillbar">
        <a href="{% url 'accounting_entry_list' %}" class="pill">All entries</a>

        {# Removed Bangladesh access button to avoid BD team reaching CA pages #}
        {# <a href="{% url 'accounting_bd_dashboard' %}" class="pill">Bangladesh dashboard</a> #}

        <a href="{% url 'production_profit_report' %}" class="pill">Production profit</a>
        <a href="{% url 'accounting_ai_audit' %}" class="pill pill-gold">AI Audit</a>
      </div>
    </div>

    <div class="cardx mb-3">
      <div class="card-body p-3">
        <form method="get" class="row g-2 align-items-end" style="font-size:13px; font-weight:800;">

          <div class="col-sm-2">
            <label class="form-label mb-1 label">Year</label>
            <input type="text" name="year" value="{{ filter_year }}" class="form-control form-control-sm inp" placeholder="2025">
          </div>

          <div class="col-sm-2">
            <label class="form-label mb-1 label">Month</label>
            <input type="text" name="month" value="{{ filter_month }}" class="form-control form-control-sm inp" placeholder="1 to 12">
          </div>

          <div class="col-sm-2">
            <button type="submit" class="pill pill-gold w-100" style="border:none;">
              Apply
            </button>
          </div>

        </form>

        <div class="subtitle" style="margin-top:10px;">Pick a year and month to filter the totals.</div>
      </div>
    </div>

    <div class="row g-3">

      <div class="col-md-4">
        <div class="cardx">
          <div class="card-body p-3">
            <div class="kpi-label">Money in</div>
            <div class="kpi-val pos">
              {{ income_cad|default_if_none:0|floatformat:2|intcomma }} CAD
            </div>
            <div class="kpi-sub">
              {{ income_bdt|default_if_none:0|floatformat:2|intcomma }} BDT
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="cardx">
          <div class="card-body p-3">
            <div class="kpi-label">Money out</div>
            <div class="kpi-val neg">
              {{ out_cad|default_if_none:0|floatformat:2|intcomma }} CAD
            </div>
            <div class="kpi-sub">
              {{ out_bdt|default_if_none:0|floatformat:2|intcomma }} BDT
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-4">
        <div class="cardx">
          <div class="card-body p-3">
            <div class="kpi-label">Net</div>
            <div class="kpi-val {% if net_cad and net_cad < 0 %}neg{% else %}pos{% endif %}">
              {{ net_cad|default_if_none:0|floatformat:2|intcomma }} CAD
            </div>
            <div class="kpi-sub">
              {{ net_bdt|default_if_none:0|floatformat:2|intcomma }} BDT
            </div>
          </div>
        </div>
      </div>

    </div>

  </div>
</div>

{% endblock %}