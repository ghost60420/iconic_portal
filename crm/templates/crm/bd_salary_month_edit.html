{% extends "crm/base.html" %}
{% block content %}

<style>
  .page-wrap{max-width:900px;margin:16px auto 28px auto;padding:0 10px;color:#f9fafb;}
  .topbar{display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap;margin-bottom:10px;}
  .title{font-size:18px;font-weight:900;}
  .sub{font-size:12px;color:#9ca3af;margin-top:2px;}
  .card{background:radial-gradient(circle at top left,#111827,#020617);border:1px solid #1f2937;border-radius:12px;padding:12px;box-shadow:0 0 10px rgba(0,0,0,.6);}
  label{font-size:11px;color:#e5e7eb;margin-bottom:3px;display:block;}
  input,select,textarea{background:#020617;color:#f9fafb;border:1px solid #374151;border-radius:10px;padding:10px 10px;font-size:12px;width:100%;}
  textarea{min-height:90px;}
  .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:10px;}
  .btn{display:inline-block;padding:10px 14px;border-radius:999px;border:1px solid transparent;font-size:12px;font-weight:900;cursor:pointer;text-decoration:none;white-space:nowrap;}
  .btn-gold{background:linear-gradient(135deg,#facc15,#f97316);color:#111827;border-color:#fbbf24;}
  .btn-slate{background:#020617;color:#e5e7eb;border-color:#374151;}
  .note{font-size:11px;color:#9ca3af;margin-top:8px;}
  .statline{display:flex;gap:14px;flex-wrap:wrap;margin-top:10px;color:#9ca3af;font-size:12px;}
  .statline b{color:#f9fafb;}
  .errorlist{margin:0 0 6px 0;padding-left:14px;font-size:11px;color:#fecaca;}
  .errorlist li{list-style:disc;}
</style>

<div class="page-wrap">

  <div class="topbar">
    <div>
      <div class="title">Edit payroll month</div>
      <div class="sub">{{ row.staff.name }} | {{ row.year }} {{ row.month }}</div>
      <div class="statline">
        <div>OT total: <b>{{ row.overtime_total_bdt|floatformat:2 }}</b></div>
        <div>Final pay: <b>{{ row.final_pay_bdt|floatformat:2 }}</b></div>
      </div>
    </div>
    <div>
      <a class="btn btn-slate" href="{% url 'bd_staff_month_list' %}?year={{ row.year }}&month={{ row.month }}">Back</a>
    </div>
  </div>

  <div class="card">
    <form method="post">
      {% csrf_token %}

      {% if form.non_field_errors %}
        <ul class="errorlist">
          {% for e in form.non_field_errors %}<li>{{ e }}</li>{% endfor %}
        </ul>
      {% endif %}

      <div class="grid">
        <div>
          <label>Base salary (BDT)</label>
          {{ form.base_salary_bdt }}
          {{ form.base_salary_bdt.errors }}
        </div>

        <div>
          <label>OT hours</label>
          {{ form.overtime_hours }}
          {{ form.overtime_hours.errors }}
        </div>

        <div>
          <label>OT rate (BDT)</label>
          {{ form.overtime_rate_bdt }}
          {{ form.overtime_rate_bdt.errors }}
        </div>

        <div>
          <label>Bonus (BDT)</label>
          {{ form.bonus_bdt }}
          {{ form.bonus_bdt.errors }}
        </div>

        <div>
          <label>Deduction (BDT)</label>
          {{ form.deduction_bdt }}
          {{ form.deduction_bdt.errors }}
        </div>

        <div>
          <label>Paid</label>
          {{ form.is_paid }}
          {{ form.is_paid.errors }}
        </div>

        <div id="paid-date-wrap">
          <label>Paid date</label>
          {{ form.paid_date }}
          {{ form.paid_date.errors }}
        </div>
      </div>

      <div style="margin-top:10px;">
        <label>Note</label>
        {{ form.note }}
        {{ form.note.errors }}
        <div class="note">Totals update after Save.</div>
      </div>

      {% for hidden in form.hidden_fields %}
        {{ hidden }}
      {% endfor %}

      <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap;">
        <button type="submit" class="btn btn-gold">Save</button>
        <a class="btn btn-slate" href="{% url 'bd_staff_month_list' %}?year={{ row.year }}&month={{ row.month }}">Cancel</a>
      </div>

    </form>
  </div>

</div>

<script>
  (function () {
    var paidBox = document.querySelector('input[name="is_paid"]');
    var paidWrap = document.getElementById("paid-date-wrap");
    if (!paidBox || !paidWrap) return;

    function togglePaidDate() {
      paidWrap.style.display = paidBox.checked ? "block" : "none";
    }

    togglePaidDate();
    paidBox.addEventListener("change", togglePaidDate);
  })();
</script>

{% endblock %}