{% extends "crm/base.html" %}
{% block content %}

<style>
  .cust-page {
    max-width: 1200px;
    margin: 24px auto 40px auto;
    padding: 0 12px;
    color: #f9fafb;
  }

  .cust-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-end;
    gap: 12px;
    flex-wrap: wrap;
    margin-bottom: 14px;
  }

  .cust-title {
    font-size: 22px;
    font-weight: 700;
    color: #fef9c3;
  }

  .cust-sub {
    font-size: 12px;
    color: #9ca3af;
  }

  .cust-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    align-items: center;
    justify-content: flex-end;
  }

  .btn {
    display: inline-block;
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid transparent;
    font-size: 12px;
    text-decoration: none;
    white-space: nowrap;
  }

  .btn-gold {
    background: linear-gradient(135deg, #facc15, #f97316);
    color: #111827;
    border-color: #fbbf24;
    font-weight: 600;
  }

  .btn-slate {
    background: #020617;
    color: #e5e7eb;
    border-color: #374151;
  }

  .cust-filters {
    background: radial-gradient(circle at top left, #111827, #020617);
    border: 1px solid #1f2937;
    border-radius: 14px;
    padding: 12px 14px;
    margin-bottom: 14px;
    display: grid;
    grid-template-columns: 2fr 1fr auto;
    gap: 10px;
    align-items: center;
  }

  .cust-filters input[type="text"] {
    width: 100%;
    background: #020617;
    color: #f9fafb;
    border: 1px solid #374151;
    border-radius: 999px;
    padding: 6px 12px;
    font-size: 12px;
  }

  .cust-filters select {
    width: 100%;
    background: #020617;
    color: #f9fafb;
    border: 1px solid #374151;
    border-radius: 999px;
    padding: 6px 10px;
    font-size: 12px;
  }

  .cust-filter-row {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    font-size: 11px;
    color: #e5e7eb;
  }

  .cust-filter-row label {
    display: flex;
    align-items: center;
    gap: 6px;
    cursor: pointer;
  }

  .cust-filter-row input[type="checkbox"] {
    accent-color: #facc15;
  }

  .table-wrap {
    background: radial-gradient(circle at top left, #111827, #020617);
    border-radius: 12px;
    border: 1px solid #1f2937;
    padding: 10px 12px;
    box-shadow: 0 0 16px rgba(0, 0, 0, 0.7);
  }

  .table {
    font-size: 12px;
    margin-bottom: 0;
  }

  .table thead th {
    border-bottom-color: #374151;
    color: #e5e7eb;
    white-space: nowrap;
  }

  .table tbody tr:hover {
    background: rgba(15, 23, 42, 0.9);
  }

  .cust-pill {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 2px 8px;
    border-radius: 999px;
    border: 1px solid #4b5563;
    font-size: 11px;
    background: #020617;
    color: #e5e7eb;
  }

  .muted {
    color: #9ca3af;
  }

  @media (max-width: 900px) {
    .cust-filters {
      grid-template-columns: 1fr;
    }
  }
</style>

<div class="cust-page">
  <div class="cust-header">
    <div>
      <div class="cust-title">ðŸ‘¥ Customers</div>
      <div class="cust-sub">All customer records with activity, production, and history in one view.</div>
    </div>
    <div class="cust-actions">
      <a href="{% url 'opportunities_list' %}" class="btn btn-slate">Back to opportunities</a>
    </div>
  </div>

  <form class="cust-filters" method="get">
    <input type="text" name="q" placeholder="Search name, company, email, or phone" value="{{ q|default:'' }}">
    <div class="cust-filter-row">
      <label>
        <input type="checkbox" name="has_active" value="1" {% if has_active %}checked{% endif %}>
        Active opportunities
      </label>
      <label>
        <input type="checkbox" name="has_production" value="1" {% if has_production %}checked{% endif %}>
        In production
      </label>
      <label>
        <input type="checkbox" name="has_completed" value="1" {% if has_completed %}checked{% endif %}>
        Completed orders
      </label>
    </div>
    <div style="display:flex; gap:6px; align-items:center; justify-content:flex-end; flex-wrap:wrap;">
      <select name="sort">
        <option value="recent" {% if sort == 'recent' %}selected{% endif %}>Recently updated</option>
        <option value="name" {% if sort == 'name' %}selected{% endif %}>Name A to Z</option>
      </select>
      <button type="submit" class="btn btn-gold">Apply</button>
      <a href="{% url 'customers_list' %}" class="btn btn-slate">Reset</a>
    </div>
  </form>

  <div class="table-wrap">
    {% if customers %}
      <div class="table-responsive">
        <table class="table table-dark table-striped table-sm align-middle">
          <thead>
            <tr>
              <th>Customer</th>
              <th>Email</th>
              <th>Phone</th>
              <th>Active opps</th>
              <th>In production</th>
              <th>Completed</th>
              <th>Last activity</th>
              <th style="text-align:right;">Open</th>
            </tr>
          </thead>
          <tbody>
            {% for c in customers %}
              <tr>
                <td>
                  <div style="font-weight:600;">
                    <a href="{% url 'customer_detail' c.pk %}">{{ c.contact_name|default:"No name" }}</a>
                  </div>
                  <div class="muted">
                    {{ c.account_brand|default:"" }}
                  </div>
                </td>
                <td>{{ c.email|default:"" }}</td>
                <td>{{ c.phone|default:"" }}</td>
                <td>
                  <span class="cust-pill">{{ c.active_opps|default:0 }}</span>
                </td>
                <td>
                  <span class="cust-pill">{{ c.production_active|default:0 }}</span>
                </td>
                <td>
                  <span class="cust-pill">{{ c.production_completed|default:0 }}</span>
                </td>
                <td class="muted">
                  {% if c.last_activity %}
                    {{ c.last_activity|date:"Y-m-d" }}
                  {% else %}
                    â€”
                  {% endif %}
                </td>
                <td style="text-align:right;">
                  <a href="{% url 'customer_detail' c.pk %}" class="btn btn-slate">View</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="muted">No customers found.</div>
    {% endif %}
  </div>
</div>

{% endblock %}
